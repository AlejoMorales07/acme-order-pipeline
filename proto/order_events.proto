syntax = "proto3";

package ecommerce.orders;

import "google/protobuf/timestamp.proto";

// Evento principal de orden
message OrderEvent {
  string event_id = 1;
  string order_id = 2;
  EventType event_type = 3;
  google.protobuf.Timestamp timestamp = 4;
  
  oneof payload {
    OrderCreated order_created = 5;
    PaymentProcessed payment_processed = 6;
    OrderConfirmed order_confirmed = 7;
    OrderFailed order_failed = 8;
  }
}

enum EventType {
  ORDER_CREATED = 0;
  PAYMENT_PROCESSED = 1;
  ORDER_CONFIRMED = 2;
  ORDER_FAILED = 3;
}

// Eventos espec√≠ficos
message OrderCreated {
  string order_id = 1;
  Customer customer = 2;
  repeated OrderItem items = 3;
}

message PaymentProcessed {
  string order_id = 1;
  PaymentResult payment_result = 2;
}

message OrderConfirmed {
  string order_id = 1;
  OrderSummary summary = 2;
}

message OrderFailed {
  string order_id = 1;
  FailureReason reason = 2;
  string error_message = 3;
}

// Tipos de datos
message Customer {
  string user_id = 1;
  string email = 2;
}

message OrderItem {
  string product_id = 1;
  string sku = 2;
  string name = 3;
  double price = 4;
  int32 quantity = 5;
}

message PaymentResult {
  PaymentStatus status = 1;
  string transaction_id = 2;
  double amount = 3;
  string failure_reason = 4;
}

enum PaymentStatus {
  PAYMENT_PENDING = 0;
  PAYMENT_COMPLETED = 1;
  PAYMENT_FAILED = 2;
}

message OrderSummary {
  double subtotal = 1;
  double tax_amount = 2;
  double total_amount = 3;
}

enum FailureReason {
  INSUFFICIENT_INVENTORY = 0;
  PAYMENT_DECLINED = 1;
  INVALID_PRODUCT = 2;
  SYSTEM_ERROR = 3;
}